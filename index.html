<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Messenger</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <style>
    /* === RESET & BASE STYLES === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000;
      height: 100vh;
      overflow: hidden;
      color: #e4e6ea;
    }

    /* === LAYOUT === */
    .messenger-container {
      display: flex;
      height: 100vh;
      max-width: none;
      background: #242526;
    }

    /* === SIDEBAR === */
    .sidebar {
      width: 360px;
      background: #242526;
      border-right: 1px solid #3a3b3c;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 16px 20px;
      border-bottom: 1px solid #3a3b3c;
      background: #242526;
    }

    .sidebar-title {
      font-size: 24px;
      font-weight: 700;
      color: #e4e6ea;
      margin-bottom: 12px;
    }

    .search-bar {
      width: 100%;
      padding: 10px 16px;
      border: none;
      background: #3a3b3c;
      border-radius: 20px;
      outline: none;
      font-size: 14px;
      color: #e4e6ea;
    }

    .search-bar::placeholder {
      color: #b0b3b8;
    }

    .contacts-list {
      flex: 1;
      overflow-y: auto;
    }

    .contact-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.15s ease;
      margin: 2px 8px;
      border-radius: 8px;
    }

    .contact-item:hover {
      background: #3a3b3c;
    }

    .contact-item.active {
      background: #1877f2;
    }

    .contact-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #42b883;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 18px;
      margin-right: 12px;
      flex-shrink: 0;
      position: relative;
    }

    .contact-avatar.group {
      background: #1877f2;
    }

    .contact-avatar::after {
      content: '';
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 16px;
      height: 16px;
      background: #42b883;
      border: 2px solid #242526;
      border-radius: 50%;
    }

    .contact-info {
      flex: 1;
      min-width: 0;
    }

    .contact-name {
      font-weight: 500;
      font-size: 15px;
      color: #e4e6ea;
      margin-bottom: 2px;
    }

    .contact-status {
      font-size: 13px;
      color: #b0b3b8;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* === CHAT AREA === */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #242526;
    }

    .chat-header {
      padding: 12px 16px;
      background: #242526;
      border-bottom: 1px solid #3a3b3c;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .mobile-menu {
      display: none;
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #1877f2;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
      position: relative;
    }

    .chat-avatar::after {
      content: '';
      position: absolute;
      bottom: 0px;
      right: 0px;
      width: 12px;
      height: 12px;
      background: #42b883;
      border: 2px solid #242526;
      border-radius: 50%;
    }

    .chat-info {
      flex: 1;
    }

    .chat-name {
      font-weight: 500;
      font-size: 15px;
      color: #e4e6ea;
    }

    .chat-status {
      font-size: 12px;
      color: #42b883;
      margin-top: 1px;
    }

    .chat-actions {
      display: flex;
      gap: 8px;
    }

    .chat-action {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.15s ease;
      color: #1877f2;
    }

    .chat-action:hover {
      background: #3a3b3c;
    }

    /* === MESSAGES === */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      background: #242526;
    }

    .message-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 12px;
    }

    .message-group.user {
      align-items: flex-end;
    }

    .message-group.bot {
      align-items: flex-start;
    }

    .message {
      max-width: 70%;
      padding: 8px 12px;
      border-radius: 18px;
      font-size: 15px;
      line-height: 1.4;
      word-wrap: break-word;
      position: relative;
    }

    .message.user {
      background: #1877f2;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.bot {
      background: #3a3b3c;
      color: #e4e6ea;
      border-bottom-left-radius: 4px;
    }

    .message.typing {
      background: #3a3b3c;
      color: #b0b3b8;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .message-time {
      font-size: 11px;
      color: #b0b3b8;
      margin-top: 4px;
      text-align: center;
    }

    /* === CODE STYLING === */
    .message code {
      background: rgba(0,0,0,0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
      font-size: 13px;
      word-break: break-all;
      overflow-wrap: break-word;
    }

    .message.user code {
      background: rgba(255,255,255,0.2);
    }

    .message pre {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
      overflow-x: auto;
      border-left: 3px solid #1877f2;
      max-width: 100%;
    }

    .message pre code {
      background: none;
      padding: 0;
      word-break: normal;
      white-space: pre;
    }

    /* === INPUT AREA === */
    .chat-input-container {
      padding: 12px 16px;
      background: #242526;
      border-top: 1px solid #3a3b3c;
    }

    .chat-input-wrapper {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      background: #3a3b3c;
      border-radius: 20px;
      padding: 8px 16px;
    }

    .chat-input {
      flex: 1;
      border: none;
      background: transparent;
      padding: 8px 0;
      outline: none;
      resize: none;
      font-family: inherit;
      font-size: 15px;
      line-height: 1.4;
      max-height: 120px;
      overflow-y: auto;
      color: #e4e6ea;
    }

    .chat-input::placeholder {
      color: #b0b3b8;
    }

    .input-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .input-action {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: #1877f2;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-button {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s ease;
      flex-shrink: 0;
      color: #1877f2;
    }

    .send-button:disabled {
      color: #65676b;
      cursor: not-allowed;
    }

    /* === KATEX STYLING === */
    .katex {
      font-size: 1.1em;
    }

    .katex-display {
      margin: 8px 0;
    }

    /* === SCROLLBAR STYLING === */
    .chat-messages::-webkit-scrollbar,
    .contacts-list::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track,
    .contacts-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb,
    .contacts-list::-webkit-scrollbar-thumb {
      background: #3a3b3c;
      border-radius: 3px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover,
    .contacts-list::-webkit-scrollbar-thumb:hover {
      background: #4e4f50;
    }

    /* === MOBILE RESPONSIVE === */
    @media (max-width: 768px) {
      .messenger-container {
        max-width: none;
      }

      .sidebar {
        position: absolute;
        left: -100%;
        width: 100%;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .chat-area {
        width: 100%;
      }

      .mobile-menu {
        display: flex;
      }

      .message {
        max-width: 85%;
      }

      .chat-messages {
        padding: 12px 16px;
      }

      .chat-input-container {
        padding: 8px 16px;
      }
    }

    @media (max-width: 480px) {
      .sidebar-header {
        padding: 12px 16px;
      }

      .contact-item {
        padding: 10px 16px;
      }

      .chat-header {
        padding: 8px 16px;
      }

      .chat-messages {
        padding: 8px 12px;
      }

      .chat-input-container {
        padding: 8px 12px;
      }

      .message {
        max-width: 90%;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="messenger-container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">Chats</div>
        <input type="text" class="search-bar" placeholder="Search Messenger">
      </div>
      <div class="contacts-list">
        <div class="contact-item active">
          <div class="contact-avatar group">G4</div>
          <div class="contact-info">
            <div class="contact-name">Group 4 Filipino 2nd Quarter</div>
            <div class="contact-status">Active now</div>
          </div>
        </div>
        <div class="contact-item">
          <div class="contact-avatar">GZ</div>
          <div class="contact-info">
            <div class="contact-name">10 - G.Y. ZARA STU...</div>
            <div class="contact-status">Paulo: 67 · 19m</div>
          </div>
        </div>
        <div class="contact-item">
          <div class="contact-avatar">ZG</div>
          <div class="contact-info">
            <div class="contact-name">Zeckieriah Giehan P. M...</div>
            <div class="contact-status">You: ayusin ko muna ui · 39m</div>
          </div>
        </div>
        <div class="contact-item">
          <div class="contact-avatar">LF</div>
          <div class="contact-info">
            <div class="contact-name">Lost and Found</div>
            <div class="contact-status">Psalms Audrey: 9/24/25 ... · 1h</div>
          </div>
        </div>
        <!-- Removed Roblox contact -->
      </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
      <div class="chat-header">
        <button class="chat-action mobile-menu" onclick="toggleSidebar()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
        <div class="chat-avatar">G4</div>
        <div class="chat-info">
          <div class="chat-name">Group 4 Filipino 2nd Quarter</div>
          <div class="chat-status">Active now</div>
        </div>
        <div class="chat-actions">
          <button class="chat-action">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.5 6.5C15.5 7.33 14.83 8 14 8S12.5 7.33 12.5 6.5 13.17 5 14 5 15.5 5.67 15.5 6.5M20.5 15.5C20.5 16.33 19.83 17 19 17S17.5 16.33 17.5 15.5 18.17 14 19 14 20.5 14.67 20.5 15.5M18 10V7L16 5L13 5V2H11V5H5V7H8V10C8 11.1 8.9 12 10 12H13C14.1 12 15 11.1 15 10V7H18V10H20V12H18V15.5C18 17.43 16.43 19 14.5 19S11 17.43 11 15.5C11 13.57 12.57 12 14.5 12C15.04 12 15.54 12.12 16 12.34V10H18M8.5 15.5C8.5 16.33 7.83 17 7 17S5.5 16.33 5.5 15.5 6.17 14 7 14 8.5 14.67 8.5 15.5Z"/>
            </svg>
          </button>
          <button class="chat-action">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
            </svg>
          </button>
          <button class="chat-action">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="chat-messages" id="messages">
        <div class="message-group bot">
          <div class="message bot">
            Hello!
          </div>
          <div class="message-time">Just now</div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <div class="input-actions">
            <button class="input-action">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8.5 8C9.33 8 10 8.67 10 9.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8zM12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4zm3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8 17 8.67 17 9.5 16.33 11 15.5 11z"/>
              </svg>
            </button>
            <button class="input-action">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 11H7v3h2v-3zm4 0h-2v3h2v-3zm4 0h-2v3h2v-3zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
              </svg>
            </button>
            <button class="input-action">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
              </svg>
            </button>
          </div>
          <textarea id="userInput" class="chat-input" placeholder="Aa" rows="1"></textarea>
          <button class="send-button" onclick="sendMessage()" id="sendButton">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M1.101 21.757L23.8 12.028L1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <script>
    // Configuration
    const CONFIG = {
      API_KEY: "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",
      MODEL: "openai/gpt-oss-120b",
      API_URL: "https://api.groq.com/openai/v1/chat/completions"
    };

    // State
    let messageHistory = [];

    // DOM Elements
    const elements = {
      textarea: document.getElementById("userInput"),
      sendButton: document.getElementById("sendButton"),
      messages: document.getElementById("messages"),
      sidebar: document.getElementById("sidebar")
    };

    // Event Listeners
    function initializeEventListeners() {
      // Auto-resize textarea
      elements.textarea.addEventListener('input', handleTextareaResize);
      
      // Enter to send message
      elements.textarea.addEventListener('keydown', handleKeydown);
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', handleOutsideClick);
      
      // Handle window resize
      window.addEventListener('resize', handleWindowResize);
    }

    // Event Handlers
    function handleTextareaResize() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    }

    function handleKeydown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }

    function handleOutsideClick(e) {
      const chatArea = document.querySelector('.chat-area');
      
      if (window.innerWidth <= 768 && 
          !elements.sidebar.contains(e.target) && 
          chatArea.contains(e.target)) {
        elements.sidebar.classList.remove('open');
      }
    }

    function handleWindowResize() {
      if (window.innerWidth > 768) {
        elements.sidebar.classList.remove('open');
      }
    }

    // Utility Functions
    function toggleSidebar() {
      elements.sidebar.classList.toggle('open');
    }

    function scrollToBottom() {
      requestAnimationFrame(() => {
        elements.messages.scrollTop = elements.messages.scrollHeight;
      });
    }

    function getCurrentTime() {
      return new Date().toLocaleTimeString([], { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
    }

    // Message Functions
    function appendMessage(content, sender, isTyping = false) {
      const messageGroup = document.createElement("div");
      messageGroup.className = `message-group ${sender}`;
      
      const message = document.createElement("div");
      message.className = `message ${sender}` + (isTyping ? " typing" : "");
      message.textContent = content;
      
      const timeDiv = document.createElement("div");
      timeDiv.className = "message-time";
      timeDiv.textContent = getCurrentTime();
      
      messageGroup.appendChild(message);
      messageGroup.appendChild(timeDiv);
      elements.messages.appendChild(messageGroup);
      
      scrollToBottom();
      return messageGroup;
    }

    function updateBotMessage(messageGroup, content) {
      const message = messageGroup.querySelector('.message');
      message.classList.remove('typing');

      // Preprocess to unescape \$ if needed
      const safeContent = content.replace(/\\\$/g, "$");

      // Parse markdown first
      message.innerHTML = marked.parse(safeContent);

      // Render LaTeX after DOM update
      requestAnimationFrame(() => {
        renderMathInElement(message, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "\$", right: "\$", display: false },
            { left: "$", right: "$", display: false }
          ],
          throwOnError: false,
          errorColor: '#cc0000'
        });
      });
    }

    // API Functions
    async function sendMessage() {
      const text = elements.textarea.value.trim();
      if (!text) return;

      // Update UI
      elements.sendButton.disabled = true;
      appendMessage(text, "user");
      elements.textarea.value = "";
      elements.textarea.style.height = 'auto';

      // Update history
      messageHistory.push({ role: "user", content: text });

      const botMessageGroup = appendMessage("Thinking...", "bot", true);

      try {
        const response = await fetch(CONFIG.API_URL, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${CONFIG.API_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: CONFIG.MODEL,
            messages: [
              { 
                role: "system", 
                content: "You are a helpful assistant. You can use LaTeX math notation for mathematical expressions. Use $...$ for inline math and $$...$$ for display math." 
              },
              ...messageHistory
            ],
            temperature: 0.7,
            max_tokens: 2000
          })
        });

        const data = await response.json();
        
        if (data.choices && data.choices.length > 0) {
          const botResponse = data.choices[0].message.content;
          messageHistory.push({ role: "assistant", content: botResponse });
          updateBotMessage(botMessageGroup, botResponse);
        } else {
          updateBotMessage(botMessageGroup, "⚠️ Sorry, I couldn't process your request. Please try again.");
        }
        
      } catch (err) {
        console.error("Error:", err);
        updateBotMessage(botMessageGroup, "⚠️ Connection error. Please check your internet and try again.");
      }

      // Re-enable UI
      elements.sendButton.disabled = false;
      scrollToBottom();
    }

    // Initialize the app
    function init() {
      initializeEventListeners();
      scrollToBottom();
    }

    // Start the app
    init();
  </script>
</body>
</html>